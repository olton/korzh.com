const id = "2018-01-22-ASP-NET-Identity-Use-claims-to-store-additional-users-data.mdx";
						const collection = "blog";
						const slug = "aspnet-identity-store-user-data-in-claims";
						const body = "import {Image} from \"astro:assets\";\r\nimport newAppImage from \"../../images/blog/anc-identity-newapp01.png\"\r\nimport registrationImage from \"../../images/blog/anc-identity-registration.png\"\r\nimport contactImage from \"../../images/blog/anc-identity-contact-name.png\"\r\n\r\n\r\n> __NB__: The solution presented in this article will work in version 2.0 of ASP.NET Core only!\r\n> If you use a newer version of ASP.NET Core (e.g. 2.2) - here is a [new post on the same topic](add-extra-user-claims-aspnet-core-webapp).\r\n\r\n## Introduction\r\nWith this post, we start a series of articles that describe the different aspects of using ASP.NET Identity in your ASP.NET (Core) applications.\r\nAll the code in the following articles was built for and tested with ASP.NET Core 2.0. However, in most cases, it will work well in earlier versions of .NET framework (4.x) and ASP.NET Identity library (2.x)\r\n\r\nOne more note. We are NOT going to do an introduction to or describe the basic principles of ASP.NET Core in general or APS.NET Identity in particular. The following material is more for the developers who already have some experience with both of them. If you don't - please start by reading the tutorials on [ASP.NET Core documentation](https://docs.microsoft.com/en-us/aspnet/core/) website and creating your first web app with it.\r\n\r\n## Problem\r\nLet's suppose we created a new ASP.NET Core project using one of the default templates and chose \"Individual user account\" option for \"Authentication\".\r\n\r\n<Image src={newAppImage} alt=\"ASP.NET Core - new project with ASP.NET Identity\" />\r\n\r\nNow when we start that newly created project and register new user we will see something like `Hello YourEmailAddress@YourCompany.com` in the top right part of the index web-page.\r\n\r\nObviously, such kind of greeting is useless in a real-world application and you would like to see the name of the currently logged user there instead (e.g. `Hello John Doe`).\r\nLet's figure out how to do it.\r\n\r\n## Solution\r\nHere we guess you are already familiar with the claims and [claims-based approach](https://docs.microsoft.com/en-us/aspnet/core/security/authorization/claims) for authorization used in ASP.NET Core Identity. If not - please read [ASP.NET Core Security](https://docs.microsoft.com/en-us/aspnet/core/security/) documentation first.\r\n\r\nTo achieve our goal we need to do 2 things:\r\n1. Add necessary information to the list of claims stored with the user's identity.\r\n2. Have a simple way of getting that info when needed.\r\n\r\nBut before implementing these two tasks we will need to add a new ContactName field to our model class and update our registration and user management pages accordingly.\r\n\r\n### 0. Preparations: ContactName property in ApplicationUser and updated views\r\nLet's add a new `ContactName` property to the ApplicationUser model class (you can find it in `Models` folder of your project):\r\n\r\n```csharp\r\npublic class ApplicationUser : IdentityUser {\r\n    public string ContactName { get; set; }\r\n}\r\n```\r\nOf course, you can add here some other properties you would like to store with your user's account, like `FirstName`, `LastName`, `Country`, `Address`, etc. but for simplicity, we will consider only one additional property.\r\n\r\nThe next step will be adding a new migration and updating your database.\r\nJust run the following commands from the terminal windows in your project's folder:\r\n\r\n```shell\r\ndotnet ef migrations add ContactNameField\r\n````\r\nand then\r\n```shell\r\ndotnet ef database update\r\n```\r\n\r\nFinally, we will need to add the new field to the views:\r\n\r\n1. `Models\\AccountViewModels\\RegisterViewModel.cs`\r\n```csharp\r\npublic class RegisterViewModel\r\n{\r\n    [Required]\r\n    [Display(Name = \"Name\")]\r\n    public string ContactName { get; set; }\r\n   .     .     .     .     .     .\r\n```\r\n\r\n2. `Views/Account/Register.chstml`\r\nAdd the following piece of markup before `Email` form group\r\n```html\r\n<div class=\"form-group\">\r\n    <label asp-for=\"ContactName\"></label>\r\n    <input asp-for=\"ContactName\" class=\"form-control\" />\r\n    <span asp-validation-for=\"ContactName\" class=\"text-danger\"></span>\r\n</div>\r\n````\r\n\r\n3. `Controllers/AccountController`\r\nUpdate the following line in the Register method:\r\n\r\n```csharp\r\nvar user = new ApplicationUser { ContactName=model.ContactName, UserName = model.Email, Email = model.Email };\r\n```\r\n\r\nAfter that, perform the similar steps in\r\n- `View/Manage/Index.cshtml`,\r\n- `Models/ManageViewModels/IndexViewModel.cs`\r\nand in\r\n- `Index` method in `ManageControler` class.\r\n\r\nTry to run your project and open the registration page. Now it should look this way:\r\n\r\n<Image src={registrationImage} alt=\"Registration form with ContactName field\" />\r\n\r\nNow, when all the preparations are finished we can return back to our main tasks.\r\n\r\n### 1. Adding a user's name to the claims\r\nIt appears that the main task is much easier than all the preparations we made before. :)\r\n\r\nThe quickest way to add some additional claims to the user's identity is to create your own implementation of `IUserClaimsPrincipalFactory` and register it in DI container.\r\n\r\nHere is the implementation of `IUserClaimsPrincipalFactory` which adds the value stored in `ContactName` property to the user's claims:\r\n\r\n```csharp\r\npublic class MyUserClaimsPrincipalFactory : UserClaimsPrincipalFactory<ApplicationUser, IdentityRole>\r\n{\r\n    public MyUserClaimsPrincipalFactory(\r\n        UserManager<ApplicationUser> userManager,\r\n        RoleManager<IdentityRole> roleManager,\r\n        IOptions<IdentityOptions> optionsAccessor)\r\n        : base(userManager, roleManager, optionsAccessor) {\r\n    }\r\n\r\n    protected override async Task<ClaimsIdentity> GenerateClaimsAsync(ApplicationUser user) {\r\n        var identity = await base.GenerateClaimsAsync(user);\r\n        identity.AddClaim(new Claim(\"ContactName\", user.ContactName ?? \"\"));\r\n        return identity;\r\n    }\r\n}\r\n```\r\n\r\nAnd then register it in DI container in `ConfigureServices` methods of your Startup class:\r\n\r\n```csharp\r\npublic void ConfigureServices(IServiceCollection services) {\r\n    .     .     .     .      .\r\n    services.AddIdentity<ApplicationUser, IdentityRole>()\r\n        .AddEntityFrameworkStores<ApplicationDbContext>()\r\n        .AddDefaultTokenProviders();\r\n\r\n    //add the following line of code\r\n    services.AddScoped<IUserClaimsPrincipalFactory<ApplicationUser>, MyUserClaimsPrincipalFactory>();\r\n    .     .     .     .      .\r\n}\r\n```\r\n\r\n### 2. Accessing new claim from the views\r\nNow we have a new claim associated with our user's identity. That's fine. But how we can get it and render on our view(s)?\r\nEasy. Any view in your application has access to `User` object which is an instance of `ClaimsPrincipal` class.\r\n\r\nThis object actually holds the list of all claims associated with the current user and you can call its `FindFirst` method to get the necessary claim and then read the `Value` property of the found claim.\r\n\r\nSo, we just need to open `_LoginPartical.cshtml` file in `Views/Shared/` folder and replace the following line:\r\n\r\n```html\r\n<a asp-area=\"\" asp-controller=\"Manage\" asp-action=\"Index\" title=\"Manage\">Hello @UserManager.GetUserName(User)!</a>\r\n```\r\nwith this one:\r\n\r\n```html\r\n<a asp-area=\"\" asp-controller=\"Manage\" asp-action=\"Index\" title=\"Manage\">Hello @(User.FindFirst(\"ContactName\").Value)!</a>\r\n```\r\nNow you instead of something like `Hello john.doe@yourcompany.com` at the top of your web-page you should see something like this:\r\n\r\n<Image src={contactImage} alt=\"ASP.NET Core - renderring contact name instead of user's ID\" />\r\n\r\n";
						const data = {title:"ASP.NET Identity - Use claims to store additional user's data",date:new Date(1516579200000),cover:{src:"/images/auth-claims.png",alt:"Alt text"},description:"With this post, we start a series of articles that describe the different aspects of using ASP.NET Identity in your ASP.NET (Core) applications",draft:false,category:"Identity",tags:["ASP-NET-CORE","ASP-NET-IDENTITY","CLAIMS"],sort:2,relatedPosts:[{slug:"aspnet-identity-weakening-password-policies",collection:"blog"},{slug:"aspnet-identity-migrate-membership-passwords",collection:"blog"},{slug:"aspnet-identity-master-password",collection:"blog"},{slug:"add-extra-user-claims-aspnet-core-webapp",collection:"blog"}]};
						const _internal = {
							type: 'content',
							filePath: "D:/Projects/sites/korzh.com/src/content/blog/2018-01-22-ASP-NET-Identity-Use-claims-to-store-additional-users-data.mdx",
							rawData: "\r\ntitle: ASP.NET Identity - Use claims to store additional user's data\r\ntags: [\"ASP-NET-CORE\", \"ASP-NET-IDENTITY\", \"CLAIMS\"]\r\nslug: aspnet-identity-store-user-data-in-claims\r\ndate: 2018-01-22\r\ncover: {\r\n    src: '/images/auth-claims.png'\r\n}\r\nsort: 2\r\ndescription: With this post, we start a series of articles that describe the different aspects of using ASP.NET Identity in your ASP.NET (Core) applications\r\nrelatedPosts:\r\n- aspnet-identity-weakening-password-policies\r\n- aspnet-identity-migrate-membership-passwords\r\n- aspnet-identity-master-password\r\n- add-extra-user-claims-aspnet-core-webapp\r\ncategory: Identity\r",
						};

export { _internal, body, collection, data, id, slug };
