const id = "2021-04-15-single-file-web-service-aspnetcore.mdx";
						const collection = "blog";
						const slug = "single-file-web-service-aspnetcore";
						const body = "import {Image} from \"astro:assets\";\r\nimport postmanImage from \"../../images/blog/postman-echo01.png\"\r\n\r\n## Introduction\r\n\r\nThere are many ways to create a web application today. We have a lot of different platforms, frameworks, and libraries: PHP, Python, Java, NodeJS, and a dozen of others.\r\n\r\nWhile ASP.NET (Core) was always a good choice for developing enterprise-level web applications (with many complex web pages, some Web API endpoints, static resources, etc.),\r\nit's never been the best choice for creating a small web service with just a few endpoints to handle REST API requests in JSON or plain text formats.\r\n\r\nWell, that was true until .NET 5 was released last year. With support for top-level statements and new features in C# language, .NET 5 allows us to create a solid web service in just a few minutes and with a single code file.\r\n\r\n## Single code file ASP.NET Core web service\r\n\r\nBelow you will find an example of a very basic \"echo\" web service with only one endpoint that just takes the content of a POST request and returns it back in JSON format. Not quite a real-world task of course, but enough for demonstration purposes.\r\n\r\nSo, to create our single-code-file web service just open your terminal, create an empty folder and type the following command:\r\n\r\n```shell\r\ndotnet new web\r\n```\r\n\r\nThis command will create a simple ASP.NET Core project with two code files: `Program.cs` and `Startup.cs`.\r\n\r\nSince our purpose is to get only one file, we remove `Startup.cs`. Yeah, it's that simple.\r\n\r\n\r\nAfter that just copy/paste the following piece of code into `Program.cs` file:\r\n\r\n```csharp\r\nusing System.IO;\r\nusing System.Net.Mime;\r\n\r\nusing Microsoft.AspNetCore.Builder;\r\nusing Microsoft.AspNetCore.Hosting;\r\nusing Microsoft.AspNetCore.Http;\r\nusing Microsoft.Extensions.Hosting;\r\n\r\n\r\nHost.CreateDefaultBuilder(args)\r\n    .ConfigureWebHostDefaults(webBuilder => webBuilder\r\n        .Configure(app => app.Run(async context => {\r\n            if (context.Request.Path == \"/api/echo\" && context.Request.Method == \"POST\") {\r\n                //getting the content of our POST request\r\n                using var reader = new StreamReader(context.Request.Body);\r\n                var content = await reader.ReadToEndAsync();\r\n\r\n                //sending it back in the response\r\n                context.Response.ContentType = MediaTypeNames.Text.Plain;\r\n                await context.Response.WriteAsync(content);\r\n            }\r\n            else {\r\n                //Return 404 for any other endpoint\r\n                context.Response.StatusCode = StatusCodes.Status404NotFound;\r\n                await context.Response.WriteAsync($\"WRONG ENDPOINT: {context.Request.Path.ToString()}. Use POST request to /api/echo instead\");\r\n            }\r\n        })))\r\n    .Build().Run();\r\n```\r\n\r\nLet's take a closer look what happens here.\r\n\r\n### Top-level statements\r\n\r\nFist we have a block of `using` statement. That's usual for any C# file. Nothing special.\r\n\r\nAfter that, we start straight with an instruction. We call `CreateDefaultBuilder()` method of `Host` class.\r\nIf you've had experience with C# before, you may be a little bit confused by this approach. No namespaces, no class definitions.\r\nYou may even say that this piece of code has the wrong syntax and will not be compiled.\r\n\r\nBut it will. It's possible to do now with C# 9 and it's called [top-level statements](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-9.0/top-level-statements).\r\n\r\n\r\n### Creating a host\r\n\r\nAs we already mentioned above the only instruction we actually have in our little program is `Host.CreateDefaultBuilder()` call.\r\nIt creates a [generic host builder](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host) with default settings for logging, configuration, and Dependency Injection container.\r\n\r\n### Setting up the web application\r\n\r\nAfter that, the `ConfigureWebHostDefaults` method loads the configuration, set Kestrel as the webserver, enables IIS integrations, and adds some default middlewares.\r\n\r\nFinally, we call `Configure` method to set up the [middleware pipeline](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/), or, to define the only middleware that will actually process all requests to our web service (with that `app.Run(...)` call).\r\n\r\nThe next piece of code is self-explanatory. If it's a POST request to `/api/echo` we read the content of the request's body and just write it back to the response stream. Otherwise, we return the 404 code with some error message.\r\n\r\nAs I mentioned above, this is a very basic example of a microweb service, but I intentionally made it simple to show how everything works in general without going into detail.\r\n\r\n\r\n## Running the app\r\n\r\nTo run this simple web service just type in the terminal (while you are in the project's directory):\r\n\r\n```shell\r\ndotnet run\r\n```\r\n\r\nHere is what you get in response by sending a POST request to /api/echo using [Postman utility](https://www.postman.com/):\r\n\r\n<Image src={postmanImage} alt=\"POST request to /api/echo via Postman\" />\r\n";
						const data = {title:"Single-file web API services with .NET 5 and ASP.NET Core",date:new Date(1618444800000),cover:{src:"/images/simple-webservice.jpg",alt:"Alt text"},description:"There are many ways to create a web application today. We have a lot of different platforms, frameworks, and libraries: PHP, Python, Java, NodeJS, and a dozen of others",draft:false,category:"general",tags:["ASP-NET-CORE","WEB-SERVICE","TOP-LEVEL-STATEMENTS"],sort:5};
						const _internal = {
							type: 'content',
							filePath: "D:/Projects/sites/korzh.com/src/content/blog/2021-04-15-single-file-web-service-aspnetcore.mdx",
							rawData: "\r\ntitle: Single-file web API services with .NET 5 and ASP.NET Core\r\ntags: [\"ASP-NET-CORE\", \"WEB-SERVICE\", \"TOP-LEVEL-STATEMENTS\"]\r\nslug: single-file-web-service-aspnetcore\r\ndate: 2021-04-15\r\ncover: {\r\nsrc: '/images/simple-webservice.jpg'\r\n}\r\nsort: 5\r\ndescription: \"There are many ways to create a web application today. We have a lot of different platforms, frameworks, and libraries: PHP, Python, Java, NodeJS, and a dozen of others\"\r",
						};

export { _internal, body, collection, data, id, slug };
